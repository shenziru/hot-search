# 热搜预测系统后端

热搜预测系统后端提供API服务，负责从多个数据源抓取热搜数据，并使用AI生成未来的热搜预测。

## 数据源

本系统使用以下数据源：

1. **今日热榜(TopHub)**：提供科技新闻热榜，包括36氪、虎嗅网、少数派等科技媒体的热门内容。
2. **脉脉职场热榜**：提供大厂八卦职场新闻，包括公司热榜和热门话题。
3. **少数派AI专栏**：提供最新的AI工具和相关文章。

## 项目结构

```
backend/
  ├── app.py              # Flask应用主入口
  ├── config/             # 配置文件目录
  │   └── data_sources.py # 数据源配置
  ├── scrapers/           # 爬虫模块目录
  │   ├── __init__.py     # 爬虫包初始化
  │   ├── manager.py      # 爬虫管理器
  │   ├── maimai_scraper.py  # 脉脉爬虫
  │   ├── sspai_scraper.py   # 少数派爬虫
  │   └── tophub_scraper.py  # 今日热榜爬虫
  ├── static/             # 静态文件和缓存
  └── temp/               # 临时文件和cookies存储
      ├── cache/          # 数据缓存
      └── maimai_cookies.json  # 脉脉cookies
```

## API接口

### 获取热搜数据

```
GET /api/hot_data
```

参数：
- `force`：是否强制刷新数据，可选值：true/1/yes

返回所有类别的热搜数据，包括：
- 科技（来自今日热榜）
- 大厂八卦职场新闻（来自脉脉）
- AI工具（来自少数派）

### 获取预测数据

```
GET /api/predictions
```

返回热搜预测数据及预测日期。

### 生成预测

```
POST /api/generate_predictions
```

请求体：
```json
{
  "hot_data": { ... } // 可选，默认使用最新热搜数据
}
```

生成新的预测数据并返回。

## 数据抓取特性

- **科技新闻**：从今日热榜(tophub.today)抓取科技相关热榜数据，包括36Kr、虎嗅网、少数派、FreeBuf等站点的热点内容。
- **大厂八卦职场新闻**：从脉脉(maimai.cn)抓取职场话题和公司热榜，提供真实的职场八卦和动态。
- **AI工具**：从少数派(sspai.com)的AI专栏抓取最新的AI工具和应用文章。

## 防错处理机制

- 每个爬虫都提供了备用数据，当网络请求失败或数据格式异常时，会自动使用备用数据确保前端显示不会为空
- 数据按热度排序，确保最热门的内容优先展示
- 定期缓存数据，减少对源站的请求频率
- 日志记录详细，便于排查问题

## 运行说明

1. 确保已安装所需依赖：
   ```
   pip install -r requirements.txt
   ```

2. 创建必要的目录：
   ```
   mkdir -p temp/cache static
   ```

3. 启动服务：
   ```
   python app.py
   ```

4. 默认服务运行在 http://localhost:5000

## 数据源配置

数据源配置位于 `config/data_sources.py`，可根据需要修改：

- 调整脉脉账号信息
- 修改数据更新频率
- 添加或移除数据源
- 调整最大获取条目数

## 其他信息

- 脉脉数据需要登录，使用cookies进行会话维持
- 所有数据会定期缓存，避免频繁请求
- 支持自动生成预测数据，基于当前热搜趋势
- 爬虫代码遵循网站robots协议，避免过度请求 